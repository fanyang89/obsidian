    https://cs.smartx.com/cases/detail?id=1035752

![](assets/Pasted%20image%2020221110102717.png)

![](assets/Pasted%20image%2020221110102756.png)

![](assets/Pasted%20image%2020221110102831.png)

![](assets/Pasted%20image%2020221110102853.png)

![](assets/Pasted%20image%2020221110102938.png)

Recover cid=4 -> cid=2 Lease owner=2，期望两副本

![](assets/Pasted%20image%2020221110103315.png)

`I1104 22:36:44` ，16 {2, 3, 4} `REPLICA WRITE FAILED` 失败，cid=2

```
# 161 chunk
W1104 22:36:43.185218 147990 session_follower.cc:288] [SESSION KEEPALIVE FAILURE]:  response: , st:
Traceback:
[ETimedOut]: ProtoAsyncClient meet timeout: expect timeout ms: 11999 elapsed ms: 12794 socket: 10.10.10.161:52254-->10.10.10.161:10103
W1104 22:36:45.093699 147990 session_follower.cc:219] [FOLLOWER SESSION JEOPARDY]
I1104 22:36:45.375399 147990 session_follower.cc:231] [FOLLOWER SESSION SLEEP BEFORE RECONNECT]
I1104 22:36:46.899292 147990 session_follower.cc:236] [FOLLOWER SESSION RECONNECT]
W1104 22:36:49.490339 147983 socket_server_transport.cc:300] [NETWORK] fd 155 failed to recv msg: Resource temporarily unavailable [11]
I1104 22:36:49.529744 147983 data_channel_server_v2.cc:105] [DATACHANNEL SERVER] lost server_transport 0x555e97d0a480 ServerTransport with peer TCP Socket (10.10.10.164:55066) via local TCP Socket (0.0.0.0:10201)
W1104 22:36:49.531929 147983 socket_server_transport.cc:300] [NETWORK] fd 69 failed to recv msg: Resource temporarily unavailable [11]
I1104 22:36:49.532696 147983 data_channel_server_v2.cc:105] [DATACHANNEL SERVER] lost server_transport 0x555e3d245cc0 ServerTransport with peer TCP Socket (10.10.10.163:33668) via local TCP Socket (0.0.0.0:10201)

I1104 22:36:51.654384 147990 session_follower.cc:236] [FOLLOWER SESSION RECONNECT]
```

```
# 161 meta
W1104 22:36:43.405140 139813 main.cc:84] [ZOO] zookeeper_interest:2288 2022-11-04 22:36:43,020:138783(0x7f28408aa700):ZOO_WARN@zookeeper_interest@2288: Exceeded deadline by 3302ms
I1104 22:36:45.783548 125124 access_manager.cc:1304] Release owner : pid: 645948 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:47.228854 125124 access_manager.cc:1304] Release owner : pid: 645951 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:47.602717 125124 access_manager.cc:1304] Release owner : pid: 9420 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:47.744374 125124 access_manager.cc:1304] Release owner : pid: 928742 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.486090 125124 access_manager.cc:1304] Release owner : pid: 645929 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.486120 125124 access_manager.cc:1304] Release owner : pid: 498507 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.486692 125124 access_manager.cc:1304] Release owner : pid: 925486 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.487697 125124 access_manager.cc:1304] Release owner : pid: 434709 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.487732 125124 access_manager.cc:1304] Release owner : pid: 926251 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.487746 125124 access_manager.cc:1304] Release owner : pid: 645938 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.487757 125124 access_manager.cc:1304] Release owner : pid: 9670 session: de2f4e5d-1457-4000-b560-f1f6e36bcc71
I1104 22:36:49.488206 125124 pextent_table.cc:219] [REMOVE REPLICA]:  2 pid: 11937
I1104 22:36:49.488243 125124 pextent_table.cc:219] [REMOVE REPLICA]:  2 pid: 925076
I1104 22:36:49.488282 125124 pextent_table.cc:219] [REMOVE REPLICA]:  2 pid: 11548
I1104 22:36:49.488306 125124 pextent_table.cc:219] [REMOVE REPLICA]:  2 pid: 874399
I1104 22:36:49.488332 125124 pextent_table.cc:219] [REMOVE REPLICA]:  2 pid: 925366
I1104 22:36:49.488354 125124 pextent_table.cc:219] [REMOVE REPLICA]:  2 pid: 459663
I1104 22:36:49.488377 125124 pextent_table.cc:219] [REMOVE REPLICA]:  2 pid: 10689

...

E1104 22:36:48.659346 139813 main.cc:81] [ZOO] handle_socket_error_msg:2390 2022-11-04 22:36:48,655:138783(0x7f28408aa700):ZOO_ERROR@handle_socket_error_msg@2390: Socket [10.10.10.163:2181] zk retcode=-7, errno=110(Connection timed out): connection to 10.10.10.163:2181 timed out (exceeded timeout by 3302ms)
W1104 22:36:49.655751 139813 main.cc:84] [ZOO] zookeeper_interest:2288 2022-11-04 22:36:49,655:138783(0x7f28408aa700):ZOO_WARN@zookeeper_interest@2288: Exceeded deadline by 10133ms
W1104 22:36:49.656054 138809 zookeeper.cc:220] zookeeper session event: CONNECTED_STATE --> CONNECTING_STATE
W1104 22:36:49.656069 138809 zookeeper.cc:183] Start the session timeout timer: 3600
I1104 22:36:49.656088 138809 quorum_cluster.cc:443] QuorumCluster state change: Running --> Running_Connecting
W1104 22:36:49.492303 125122 session.cc:199] [SESSION EXPIRED]: session_epoch { uuid: "a1ee10af-a8b6-4d50-b11d-eb09642685ac" epoch: 202517316 } group: "access" lease_expire_ns: 12563719219528188 state: 2
E1104 22:36:49.670372 125122 session.cc:214] [BUG]: session expired caused by delayed RPC
I1104 22:36:49.672714 125122 access_manager.cc:1171] [ACCESS SESSION EXPIRED]: session_epoch { uuid: "a1ee10af-a8b6-4d50-b11d-eb09642685ac" epoch: 202517316 } group: "access" lease_expire_ns: 12563719219528188 uuid: "a1ee10af-a8b6-4d50-b11d-eb09642685ac" ip: "10.10.10.161" num_ip: 2701789706 port: 10201 cid: 2 secondary_data_ip: "172.16.43.161" zone: "default" scvm_mode_host_data_ip: ""
I1104 22:36:49.673352 125122 chunk_table.cc:837] Chunk 2 status change: CHUNK_STATUS_CONNECTED_HEALTHY --> CHUNK_STATUS_SESSION_EXPIRED
W1104 22:36:49.673460 125122 session.cc:199] [SESSION EXPIRED]: session_epoch { uuid: "de2f4e5d-1457-4000-b560-f1f6e36bcc71" epoch: 781440569 } group: "access" lease_expire_ns: 12563719219534300 state: 2
E1104 22:36:49.673480 125122 session.cc:214] [BUG]: session expired caused by delayed RPC
I1104 22:36:49.673494 125122 access_manager.cc:1171] [ACCESS SESSION EXPIRED]: session_epoch { uuid: "de2f4e5d-1457-4000-b560-f1f6e36bcc71" epoch: 781440569 } group: "access" lease_expire_ns: 12563719219534300 uuid: "de2f4e5d-1457-4000-b560-f1f6e36bcc71" ip: "10.10.10.164" num_ip: 2752121354 port: 10201 cid: 1 secondary_data_ip: "172.16.43.164" zone: "default" scvm_mode_host_data_ip: ""
I1104 22:36:49.674839 125122 chunk_table.cc:837] Chunk 1 status change: CHUNK_STATUS_CONNECTED_HEALTHY --> CHUNK_STATUS_SESSION_EXPIRED
W1104 22:36:49.674937 125122 session.cc:199] [SESSION EXPIRED]: session_epoch { uuid: "1b928637-1a8f-4e08-a9b0-8e044094b601" epoch: 1106520848 } group: "access" lease_expire_ns: 12563722321210192 state: 2
E1104 22:36:49.674957 125122 session.cc:214] [BUG]: session expired caused by delayed RPC
I1104 22:36:49.674983 125122 access_manager.cc:1171] [ACCESS SESSION EXPIRED]: session_epoch { uuid: "1b928637-1a8f-4e08-a9b0-8e044094b601" epoch: 1106520848 } group: "access" lease_expire_ns: 12563722321210192 uuid: "1b928637-1a8f-4e08-a9b0-8e044094b601" ip: "10.10.10.163" num_ip: 2735344138 port: 10201 cid: 3 secondary_data_ip: "172.16.43.163" zone: "default" scvm_mode_host_data_ip: ""
I1104 22:36:49.675825 125122 chunk_table.cc:837] Chunk 3 status change: CHUNK_STATUS_CONNECTED_HEALTHY --> CHUNK_STATUS_SESSION_EXPIRED
W1104 22:36:49.676812 125122 session.cc:199] [SESSION EXPIRED]: session_epoch { uuid: "87e4a9cb-a8fe-4424-ae99-2f18c261f7a7" epoch: 74927736 } group: "access" lease_expire_ns: 12563722321295870 state: 2
E1104 22:36:49.676841 125122 session.cc:214] [BUG]: session expired caused by delayed RPC
I1104 22:36:49.676856 125122 access_manager.cc:1171] [ACCESS SESSION EXPIRED]: session_epoch { uuid: "87e4a9cb-a8fe-4424-ae99-2f18c261f7a7" epoch: 74927736 } group: "access" lease_expire_ns: 12563722321295870 uuid: "87e4a9cb-a8fe-4424-ae99-2f18c261f7a7" ip: "10.10.10.162" num_ip: 2718566922 port: 10201 cid: 4 secondary_data_ip: "172.16.43.162" zone: "default" scvm_mode_host_data_ip: ""
I1104 22:36:49.677515 125122 chunk_table.cc:837] Chunk 4 status change: CHUNK_STATUS_CONNECTED_HEALTHY --> CHUNK_STATUS_SESSION_EXPIRED
I1104 22:36:49.661969 139813 main.cc:89] [ZOO] check_events:2477 2022-11-04 22:36:49,661:138783(0x7f28408aa700):ZOO_INFO@check_events@2477: initiated connection to server [10.10.10.162:2181]
E1104 22:36:49.690063 139813 main.cc:81] [ZOO] handle_socket_error_msg:2514 2022-11-04 22:36:49,690:138783(0x7f28408aa700):ZOO_ERROR@handle_socket_error_msg@2514: Socket [10.10.10.162:2181] zk retcode=-112, errno=116(Stale file handle): sessionId=0x3001e647d600030 has expired.

I1104 22:36:49.717777 138809 quorum_cluster.cc:443] QuorumCluster state change: Expired --> Stopped
I1104 22:36:49.717784 138809 quorum_cluster.cc:210] Sending stopping signal to upper layer.
I1104 22:36:49.717792 138809 quorum_server.cc:59] Get quorum cluster event: STOPPED
```

```
# 163 meta
I1104 22:36:49.275529 232007 quorum_cluster.cc:518] [ROLE CHANGE] I am the leader now. seq is 91
I1104 22:36:53.009012 120699 meta_server.cc:342] Meta status change to new status: META_RUNNING meta addr: 10.10.10.163 port: 10100. Last status was: META_BOOTING which last for 3585 ms
```

![](assets/Pasted%20image%2020221110162515.png)

```
Journal features:         journal_incompat_revoke journal_64bit journal_checksum_v3
Journal size:             256M
Journal length:           65536
Journal sequence:         0x00003c1c
Journal start:            36108
Journal checksum type:    crc32c
Journal checksum:         0xcfee9977
```
