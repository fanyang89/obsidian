```
-> % rg -I 'Exception when following the leader' $(fd zookeeper.log) | grep '07-20T' | grep 'myid=1' | wc -l
     169
-> % rg -I 'Exception when following the leader' $(fd zookeeper.log) | grep '07-20T' | grep 'myid=2' | wc -l
     168
-> % rg -I 'Exception when following the leader' $(fd zookeeper.log) | grep '07-20T' | grep 'myid=3' | wc -l
     168
-> % rg -I 'Exception when following the leader' $(fd zookeeper.log) | grep '07-20T' | grep 'myid=4' | wc -l
     168
-> % rg -I 'Exception when following the leader' $(fd zookeeper.log) | grep '07-20T' | grep 'myid=5' | wc -l
       1
```

```
-> % fd zookeeper.log | awk -F/ '{print $1}' | sort -n | uniq -c
   3 10_10_10_146
   3 10_10_10_147
   4 10_10_10_148
   3 10_10_10_152
   3 10_10_10_153
```

![[Pasted image 20250723151531.png]]

```
2025-07-20T00:02:04,705 [myid:] - WARN  [NIOWorkerThread-2:ZooKeeperServer@1079] - Connection request from old client /10.10.10.153:37360; will be dropped if server is in r-o mode
2025-07-20T00:02:04,705 [myid:] - INFO  [NIOWorkerThread-2:Learner@115] - Revalidating client: 0x50618e08c482bd2
2025-07-20T00:02:04,745 [myid:] - INFO  [NIOWorkerThread-1:Learner@115] - Revalidating client: 0x400000d2545843a
2025-07-20T00:02:04,749 [myid:] - WARN  [QuorumPeer[myid=1](plain=10.10.10.146:2181)(secure=disabled):Follower@100] - Exception when following the leader
java.net.SocketTimeoutException: Read timed out
	at java.net.SocketInputStream.socketRead0(Native Method) ~[?:1.8.0_402]
	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116) ~[?:1.8.0_402]
	at java.net.SocketInputStream.read(SocketInputStream.java:171) ~[?:1.8.0_402]
	at java.net.SocketInputStream.read(SocketInputStream.java:141) ~[?:1.8.0_402]
	at java.net.SocketInputStream.read(SocketInputStream.java:224) ~[?:1.8.0_402]
	at java.io.DataInputStream.readInt(DataInputStream.java:387) ~[?:1.8.0_402]
	at org.apache.jute.BinaryInputArchive.readInt(BinaryInputArchive.java:84) ~[zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
	at org.apache.zookeeper.server.quorum.QuorumPacket.deserialize(QuorumPacket.java:86) ~[zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
	at org.apache.jute.BinaryInputArchive.readRecord(BinaryInputArchive.java:118) ~[zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
	at org.apache.zookeeper.server.quorum.Learner.readPacket(Learner.java:166) ~[zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
	at org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:96) [zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1347) [zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
2025-07-20T00:02:04,750 [myid:] - INFO  [QuorumPeer[myid=1](plain=10.10.10.146:2181)(secure=disabled):Follower@206] - shutdown called
java.lang.Exception: shutdown Follower
	at org.apache.zookeeper.server.quorum.Follower.shutdown(Follower.java:206) [zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:1351) [zookeeper-3.9.9.jar:3.9.9-66d5735a175a824e9804d74497cb1023086dbd6a]
2025-07-20T00:02:04,752 [myid:] - INFO  [QuorumPeer[myid=1](plain=10.10.10.146:2181)(secure=disabled):LearnerZooKeeperServer@183] - Shutting down
2025-07-20T00:02:04,752 [myid:] - INFO  [QuorumPeer[myid=1](plain=10.10.10.146:2181)(secure=disabled):SyncRequestProcessor@278] - Shutting down
2025-07-20T00:02:04,752 [myid:] - INFO  [SyncThread:1:SyncRequestProcessor@243] - SyncRequestProcessor exited!
2025-07-20T00:02:04,753 [myid:] - INFO  [QuorumPeer[myid=1](plain=10.10.10.146:2181)(secure=disabled):ZooKeeperServer@624] - shutting down
2025-07-20T00:02:04,753 [myid:] - INFO  [QuorumPeer[myid=1](plain=10.10.10.146:2181)(secure=disabled):FollowerRequestProcessor@139] - Shutting down
2025-07-20T00:02:04,753 [myid:] - INFO  [QuorumPeer[myid=1](plain=10.10.10.146:2181)(secure=disabled):CommitProcessor@362] - Shutting down
2025-07-20T00:02:04,753 [myid:] - INFO  [CommitProcessor:1:CommitProcessor@195] - CommitProcessor exited loop!
```

```bash
-> % rg 'GC pause' | awk '{print $(NF-1)}' | sort -n | python -c 'import sys; a = [float(x) for x in sys.stdin]; print("sum:", sum(a)); print("avg:", sum(a)/len(a)); print("min:", min(a)); print("max:", max(a)); print("count:",len(a));'
('sum:', 3240.89585220002)
('avg:', 0.20514595848841752)
('min:', 0.1744269)
('max:', 0.4796178)
('count:', 15798)
```

```bash
// 10_10_10_152/zbs_logs/zbs-metad/zbs-metad.log.20250719-155406.5095
I0720 00:02:02.193142 25812 meta_rpc_server.cc:2125] [SET PEXTENT EXISTENCE]: [REQUEST]: pid: 3532148 origin_pid: 0 epoch: 20379006 origin_epoch: 0 generation: 1, [RESPONSE]: ST:OK, , [TIME]: 1725 us.
I0720 00:02:02.263358 25812 meta_rpc_server.cc:1008] [COW PEXTENT]: pid: 3379307 new pid: 3532150 loc: [2 5 ] volume: name: "5309c0e2-3649-4c6d-ae3a-d23898af0c92" size: 8796093022208 created_time { seconds: 1688014860 nseconds: 702626172 } id: "5309c0e2-3649-4c6d-ae3a-d23898af0c92" parent_id: "7c122824-a0f1-4b16-90c7-31f26c043f1a" origin_id: "1789ad1e-ca43-4fb8-b793-cc400cf73815" replica_num: 2 thin_provision: true iops_burst: 0 bps_burst: 0 throttling { } stripe_num: 4 stripe_size: 262144 access_points { cid: 2 }
I0720 00:02:02.281085 25812 meta_rpc_server.cc:2125] [SET PEXTENT EXISTENCE]: [REQUEST]: pid: 3532150 origin_pid: 0 epoch: 20379008 origin_epoch: 0 generation: 1, [RESPONSE]: ST:OK, , [TIME]: 2070 us.
W0720 00:02:04.734135  1790 rpc_server.h:97] rpc server was unable to send response when when responsing method: zbs.consensus.SessionService.KeepAlive response: session_epoch { uuid: "b8f75f39-09ca-467a-852d-605b506e1783" epoch: 275914971 } lease_interval_ns: 8999373996 cluster_uuid: "1a2c31d7-2ae8-42b0-8116-365673572fda" aware_time_cost: true [zbs.meta.AccessKeepAliveResponse.response] { recover_mode: RECOVER_AUTO migrate_mode: MIGRATE_AUTO nvmf_target_id: 4 isolate_info { my_chunk_id: 4 } } [zbs.meta.ChunkKeepAliveResponse.response] { reserve_space: 0 } ec: [ESocket]
E0720 00:02:04.948199 25813 main.cc:81] [ZOO] handle_socket_error_msg:2522 2025-07-20 00:02:04,948:5095(0x7f5955d6b700):ZOO_ERROR@handle_socket_error_msg@2522: Socket [10.10.10.152:2181] zk retcode=-7, errno=110(Connection timed out): connection to 10.10.10.152:2181 timed out (exceeded timeout by 1ms)
W0720 00:02:04.948659 25813 main.cc:84] [ZOO] zookeeper_interest:2449 2025-07-20 00:02:04,948:5095(0x7f5955d6b700):ZOO_WARN@zookeeper_interest@2449: Delaying connection after exhaustively trying all servers [10.10.10.152:2181,10.10.10.147:2181,10.10.10.153:2181,10.10.10.146:2181,10.10.10.148:2181]
W0720 00:02:04.948875 25815 zookeeper.cc:223] zookeeper session event: CONNECTED_STATE --> CONNECTING_STATE
W0720 00:02:04.948887 25815 zookeeper.cc:189] Start the session timeout timer: 200
I0720 00:02:04.948913 25815 quorum_cluster.cc:393] QuorumCluster state change: Running --> Running_Connecting
I0720 00:02:04.949653 25813 main.cc:89] [ZOO] check_events:2629 2025-07-20 00:02:04,949:5095(0x7f5955d6b700):ZOO_INFO@check_events@2629: initiated connection to server [10.10.10.148:2181]
E0720 00:02:04.957154 25813 main.cc:81] [ZOO] handle_socket_error_msg:2647 2025-07-20 00:02:04,957:5095(0x7f5955d6b700):ZOO_ERROR@handle_socket_error_msg@2647: Socket [10.10.10.148:2181] zk retcode=-4, errno=112(Host is down): failed while receiving a server response
I0720 00:02:04.957937 25813 main.cc:89] [ZOO] check_events:2629 2025-07-20 00:02:04,957:5095(0x7f5955d6b700):ZOO_INFO@check_events@2629: initiated connection to server [10.10.10.153:2181]
E0720 00:02:05.058606 25813 main.cc:81] [ZOO] handle_socket_error_msg:2647 2025-07-20 00:02:05,058:5095(0x7f5955d6b700):ZOO_ERROR@handle_socket_error_msg@2647: Socket [10.10.10.153:2181] zk retcode=-4, errno=112(Host is down): failed while receiving a server response
I0720 00:02:05.059340 25813 main.cc:89] [ZOO] check_events:2629 2025-07-20 00:02:05,059:5095(0x7f5955d6b700):ZOO_INFO@check_events@2629: initiated connection to server [10.10.10.146:2181]
W0720 00:02:05.148940 25815 zookeeper.cc:205] Stop the session timeout timer.
W0720 00:02:05.148986 25815 zookeeper.cc:223] zookeeper session event: CONNECTING_STATE --> EXPIRED_SESSION_STATE
```

```bash
fanyang@Mac-mini [15:43:53] [/Volumes/WD_BLACK/download/cluster-logs-2025071910-2025072110-4a0d8348/10_10_10_152/base_component_logs/zookeeper]

-> % rg -I 'Peer state changed:' | sort
2025-07-20T00:02:06,008 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@751] - Peer state changed: looking
2025-07-20T00:02:06,064 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@745] - Peer state changed: following
2025-07-20T00:02:06,066 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@751] - Peer state changed: following - discovery
2025-07-20T00:02:10,076 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@751] - Peer state changed: looking
2025-07-20T00:02:10,086 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@745] - Peer state changed: following
2025-07-20T00:02:10,086 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@751] - Peer state changed: following - discovery

// ...
2025-07-20T00:23:03,327 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@751] - Peer state changed: leading - discovery
2025-07-20T00:23:04,361 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@751] - Peer state changed: leading - synchronization
2025-07-20T00:23:05,670 [myid:] - INFO  [QuorumPeer[myid=4](plain=10.10.10.152:2181)(secure=disabled):QuorumPeer@751] - Peer state changed: leading - broadcast
```
