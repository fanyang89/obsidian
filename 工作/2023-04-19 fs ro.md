```
[root@arm-node-18-49 18:38:32 logs]$grep -rhi 'b30e2080-3b0b-4b74-91cf-569a0d72e745'
I1007 19:52:59.950376 3200438 iscsi_server.cc:1341] [CREATE ISCSI LUN]: [REQUEST]: lun_path { pool_path { pool_name: "zbs-iscsi-datastore-1658318295190s" } lun_id: 231 lun_name: "b30e2080-3b0b-4b74-91cf-569a0d72e745" } src_lun_path { pool_path { pool_name: "zbs-iscsi-datastore-1654851216469u" } lun_id: 247 } single_access: false stripe_num: 4 stripe_size: 262144, [RESPONSE]: ST:OK, lun_id: 231 pool_id: "af7cbc3d-2fd6-4945-b3f9-a1877f502460" volume_id: "0fb98074-fa79-433a-a7a7-b67e64e4b83b" created_time { seconds: 1665143579 nseconds: 942544738 } size: 214748364800 description: "" replica_num: 2 thin_provision: true throttling { } name: "b30e2080-3b0b-4b74-91cf-569a0d72e745" naa: "3334d97afd47089bf" single_access: false stripe_num: 4 stripe_size: 262144 pr_info { gen: 0 }, [TIME]: 11064 us.

I1007 19:53:02.550129 3200438 iscsi_server.cc:1884] [UPDATE ISCSI LUN]: [REQUEST]: lun_path { pool_path { pool_name: "zbs-iscsi-datastore-1658318295190s" } lun_id: 231 } new_allowed_initiators: "iqn.2013-11.org.smartx:5792990a-0470-49db-a337-c1a103c1521c.a0771b88-e7c8-11ec-aaf5-525400ee856a.0", [RESPONSE]: ST:OK, lun_id: 231 pool_id: "af7cbc3d-2fd6-4945-b3f9-a1877f502460" volume_id: "0fb98074-fa79-433a-a7a7-b67e64e4b83b" created_time { seconds: 1665143579 nseconds: 942544738 } size: 214748364800 description: "" replica_num: 2 thin_provision: true throttling { } name: "b30e2080-3b0b-4b74-91cf-569a0d72e745" naa: "3334d97afd47089bf" allowed_initiators: "iqn.2013-11.org.smartx:5792990a-0470-49db-a337-c1a103c1521c.a0771b88-e7c8-11ec-aaf5-525400ee856a.0" single_access: false stripe_num: 4 stripe_size: 262144 pr_info { gen: 0 }, [TIME]: 5935 us.

I1007 19:53:02.553351 3200438 iscsi_server.cc:1884] [UPDATE ISCSI LUN]: [REQUEST]: lun_path { pool_path { pool_name: "zbs-iscsi-datastore-1658318295190s" } lun_id: 231 } single_access: true, [RESPONSE]: ST:OK, lun_id: 231 pool_id: "af7cbc3d-2fd6-4945-b3f9-a1877f502460" volume_id: "0fb98074-fa79-433a-a7a7-b67e64e4b83b" created_time { seconds: 1665143579 nseconds: 942544738 } size: 214748364800 description: "" replica_num: 2 thin_provision: true throttling { } name: "b30e2080-3b0b-4b74-91cf-569a0d72e745" naa: "3334d97afd47089bf" allowed_initiators: "iqn.2013-11.org.smartx:5792990a-0470-49db-a337-c1a103c1521c.a0771b88-e7c8-11ec-aaf5-525400ee856a.0" single_access: true stripe_num: 4 stripe_size: 262144 pr_info { gen: 0 }, [TIME]: 2175 us.

I1101 11:30:07.923254 2967397 iscsi_server.cc:2032] [UPDATE ISCSI LUN]: [REQUEST]: lun_path { pool_path { pool_name: "zbs-iscsi-datastore-1658318295190s" } lun_id: 231 } new_allowed_initiators: "iqn.2013-11.org.smartx:5792990a-0470-49db-a337-c1a103c1521c.a0771b88-e7c8-11ec-aaf5-525400ee856a.0", [RESPONSE]: ST:OK, lun_id: 231 pool_id: "af7cbc3d-2fd6-4945-b3f9-a1877f502460" volume_id: "0fb98074-fa79-433a-a7a7-b67e64e4b83b" created_time { seconds: 1665143579 nseconds: 942544738 } size: 214748364800 description: "" replica_num: 2 thin_provision: true throttling { } name: "b30e2080-3b0b-4b74-91cf-569a0d72e745" naa: "3334d97afd47089bf" allowed_initiators: "iqn.2013-11.org.smartx:5792990a-0470-49db-a337-c1a103c1521c.a0771b88-e7c8-11ec-aaf5-525400ee856a.0" single_access: true stripe_num: 4 stripe_size: 262144 pr_info { gen: 0 }, [TIME]: 28710 us.

I1101 11:30:07.966933 2967397 iscsi_server.cc:2032] [UPDATE ISCSI LUN]: [REQUEST]: lun_path { pool_path { pool_name: "zbs-iscsi-datastore-1658318295190s" } lun_id: 231 } single_access: true, [RESPONSE]: ST:OK, lun_id: 231 pool_id: "af7cbc3d-2fd6-4945-b3f9-a1877f502460" volume_id: "0fb98074-fa79-433a-a7a7-b67e64e4b83b" created_time { seconds: 1665143579 nseconds: 942544738 } size: 214748364800 description: "" replica_num: 2 thin_provision: true throttling { } name: "b30e2080-3b0b-4b74-91cf-569a0d72e745" naa: "3334d97afd47089bf" allowed_initiators: "iqn.2013-11.org.smartx:5792990a-0470-49db-a337-c1a103c1521c.a0771b88-e7c8-11ec-aaf5-525400ee856a.0" single_access: true stripe_num: 4 stripe_size: 262144 pr_info { gen: 0 }, [TIME]: 14614 us.

[root@arm-node-18-49 18:38:46 logs]$grep -ril 'b30e2080-3b0b-4b74-91cf-569a0d72e745'
zbs-metad.log.20221007-034528.2573310
zbs-metad.log.20221018-182908.1676211
```

![](assets/Pasted%20image%2020230419190407.png)

![](assets/Pasted%20image%2020230419190609.png)

![](assets/Pasted%20image%2020230419190640.png)

![](assets/Pasted%20image%2020230419191641.png)

```
[root@arm-node-18-50 20:38:36 logs]$zbs-iscsi lun show zbs-iscsi-datastore-1658318295190s 231
------------------  --------------------------------------------------------------------------------------------------
LUN Id              231
LUN Name            b30e2080-3b0b-4b74-91cf-569a0d72e745
Size                200.00 GiB
Unique Size         19.50 GiB
Shared Size         73.75 GiB
Volume id           0fb98074-fa79-433a-a7a7-b67e64e4b83b
Replica Num         2
Thin Provision      True
Creation Time       2022-10-07 19:52:59.942544738
Description
NAA                 3334d97afd47089bf
Allowed Initiators  iqn.2013-11.org.smartx:5792990a-0470-49db-a337-c1a103c1521c.a0771b88-e7c8-11ec-aaf5-525400ee856a.0
Single Access       True
PR                  Details
Prefer CID          0
Read Only           False
Secondary ID
------------------  --------------------------------------------------------------------------------------------------
```

```
[root@arm-node-18-50 20:38:45 logs]$ zbs-meta chunk list
  ID  IP            Host Name         Port  Storage Pool    Use State    Link Status        Data Capacity    Used Space    Provisioned Space    Failure Data Space    Failure Cache Space    Cache Capacity    Used Cache Space    Registered Date      LSM Version    Zone     Maintenance Mode
----  ------------  --------------  ------  --------------  -----------  -----------------  ---------------  ------------  -------------------  --------------------  ---------------------  ----------------  ------------------  -------------------  -------------  -------  ------------------
   1  10.168.18.48  arm-node-18-48   10200  system          IN_USE       CONNECTED_HEALTHY  15.41 TiB        12.16 TiB     12.16 TiB            0.00 B                0.00 B                 1.50 TiB          1.25 TiB            2022-06-10 15:45:50  2.2.1          default  False
   2  10.168.18.49  arm-node-18-49   10200  system          IN_USE       CONNECTED_HEALTHY  15.41 TiB        12.19 TiB     12.19 TiB            0.00 B                0.00 B                 1.50 TiB          1.35 TiB            2022-06-10 15:45:51  2.2.1          default  False
   3  10.168.18.50  arm-node-18-50   10200  system          IN_USE       CONNECTED_HEALTHY  15.41 TiB        12.25 TiB     12.25 TiB            0.00 B                0.00 B                 1.50 TiB          964.29 GiB          2022-06-10 15:46:00  2.2.1          default  False
```

3 get generation 1 失败

```bash
# cid=3
W0411 03:27:34.242640 4188868 recover_handler.cc:438] [CHECK AGILE RECOVER]: Failed to get dst extent generation:
Traceback: [ENotFound]: Failed to get generation, pid: 4956370 cid: 1
```

```bash
# cid=1
E0411 03:27:34.238435 2990623 local_io_handler.cc:186] local io failed: GET_GENERATION version: 4098, error_code: 0, op: 8, buf_len: 0, message_id: 5006366360 , pid: 4956370, origin_pid: 0, generation: 0, epoch: 5090243, origin_epoch: 0, flags: 1
ENotFound
```

```
[root@arm-node-18-50 21:28:05 logs]$zbs-meta volume show zbs-iscsi-datastore-1658318295190s 0fb98074-fa79-433a-a7a7-b67e64e4b83b
--------------  ------------------------------------
ID              0fb98074-fa79-433a-a7a7-b67e64e4b83b
Name            0fb98074-fa79-433a-a7a7-b67e64e4b83b
Parent ID       af7cbc3d-2fd6-4945-b3f9-a1877f502460
Size            200.00 GiB
Unique Size     19.50 GiB
Shared Size     73.75 GiB
Creation Time   2022-10-07 19:52:59.942544738
Status          VOLUME_ONLINE
Replica Number  2
Thin Provision  True
Read Only       False
Description
Alloc Even      False
Clone count     9
Iops            0
Iops Read       0
Iops Write      0
Bps             0
Bps Read        0
Bps Write       0
Stripe Num      4
Stripe Size     262144
Prefer CID      0
--------------  ------------------------------------
```

```bash
W0409 13:02:34.256572 4188868 zbs_client.cc:963] [IO failed]: [IOCTX]: VEXTENT_WRITE seq: 13521843525, volume: 0fb98074-fa79-433a-a7a7-b67e64e4b83b, in_progress: 0, volume_offset: 48590016512, len: 4096, return_not_alloc: 0, resize: 0, retry_times: 197, next_retry_ms: 17265386677 , vextent no: 180, data_len: 4096, extent_offset: 67948544, pid: 4912932, owner_ip: 10.168.18.50, owner_port: 10201  st:

I0409 13:02:34.256682 4188868 zbs_client.cc:975] IO retry done, [IOCTX]: VEXTENT_WRITE seq: 13521843525, volume: 0fb98074-fa79-433a-a7a7-b67e64e4b83b, in_progress: 0, volume_offset: 48590016512, len: 4096, return_not_alloc: 0, resize: 0, retry_times: 197, next_retry_ms: 17265386677 , vextent no: 180, data_len: 4096, extent_offset: 67948544, pid: 4912932, owner_ip: 10.168.18.50, owner_port: 10201  st:

W0409 13:02:34.256706 4188868 zbs_client.cc:985] [CLIENT SLOW IO TRACE] [IOCTX]: VEXTENT_WRITE seq: 13521843525, volume: 0fb98074-fa79-433a-a7a7-b67e64e4b83b, in_progress: 0, volume_offset: 48590016512, len: 4096, return_not_alloc: 0, resize: 0, retry_times: 197, next_retry_ms: 17265386677 , vextent no: 180, data_len: 4096, extent_offset: 67948544, pid: 4912932, owner_ip: 10.168.18.50, owner_port: 10201  elapsed 601843 ms
```

为什么 write 失败？

```
246541   │ I0409 12:42:30.074481 4188868 generation_syncor.cc:116] [SYNC GENERATION START] pid: 4912932 loc: [3 ]
246542   │ E0409 12:42:30.074545 4188868 generation_syncor.cc:125] [SYNC GENERATION FAIL]  pid: 4912932 loc: [3 ]
246543   │ Traceback:
246544   │ [ECSyncGeneration]: Synced gen is smaller than expected generation. pid: 4912932 gen: 0 meta gen: 226484
```
