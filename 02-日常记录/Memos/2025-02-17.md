---
title: "2025-02-17"
---

# 2025-02-17

## ETCD

### HardState

```go
type HardState struct {
  // 节点当前的任期号
	Term   uint64 `protobuf:"varint,1,opt,name=term" json:"term"`
	// 节点在当前任期中，投票给了谁
	Vote   uint64 `protobuf:"varint,2,opt,name=vote" json:"vote"`
	// 当前已经提交的最高日志索引
	Commit uint64 `protobuf:"varint,3,opt,name=commit" json:"commit"`
}
```

### MsgApp

在etcd的Raft实现中，`MsgApp`消息用于Leader向Follower同步日志条目，其核心字段含义如下：

```markdown
r.Step(pb.Message{
From: 2, // 发送者ID（Leader节点）
To: 1, // 接收者ID（Follower节点）
Type: pb.MsgApp, // 消息类型（日志追加请求）
Term: 2, // Leader的当前任期号
LogTerm: tt.term, // 前一条日志的任期号
Index: tt.index // 前一条日志的索引值
})
```

### 字段解析

1. **From** `(uint64)`  
   消息发送者的节点ID，此处为Leader节点2
2. **To** `(uint64)`  
   消息接收者的节点ID，此处为Follower节点1
3. **Type** `(pb.MessageType)`  
   固定为`MsgApp`，表示日志追加请求
4. **Term** `(uint64)`  
   Leader的当前任期号，用于检测过期Leader（若Follower的Term更大，则拒绝请求）
5. **LogTerm** `(uint64)`  
   前一条日志的任期号，与`Index`共同用于**日志一致性检查**。Follower会验证本地日志中`Index`位置的条目是否具有相同的Term
6. **Index** `(uint64)`  
   前一条日志的索引值，用于定位Follower日志中需要匹配的位置。在etcd的Raft实现中，
