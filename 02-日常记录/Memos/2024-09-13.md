---
title: "2024-09-13"
---

# 2024-09-13

> How about throw exception in case of deletion failure?

Delete failures are usually due to permissions or disk failure. For example, the `zookeeper` user only has read access to the data directory, so deleting the empty log file will fail. 1) If the disk completes the I/O in less time than the I/O timeout, it may be retrying in the blk layer, just slower, but it won't fail. 2) When the disk I/O timeout occurs, most filesystems will remount as read-only, and zookeeper will suffer with insufficient permissions. 3) I/O may not always return properly if the disk is broken from my experience, the process is blocked in the uninterruptible state. When delete failed (filesystem readonly) and throw I/O exception, the server restarted, and failed again. If we didn't throw the exception, the server will fail on the next write with fsync (usually writing new epoch files after FLE completed and reaches initLimit timeout).
I don't think we can do much more about the deletion failure.
