```
get_xid():
        sub     rsp, 8
        mov     eax, DWORD PTR get_xid()::xid[rip]
        cmp     eax, -1
        je      .L5
.L2:
        mov     eax, 1
        lock xadd       DWORD PTR get_xid()::xid[rip], eax
        add     rsp, 8
        ret
.L5:
        xor     edi, edi
        call    time
        xchg    eax, DWORD PTR get_xid()::xid[rip]
        jmp     .L2
get_xid()::xid:
        .long   -1
```

```
get_xid2():
        push    rbx
        mov     ebx, 1
        lock xadd       DWORD PTR get_xid2()::xid[rip], ebx
        test    ebx, ebx
        je      .L5
.L1:
        mov     eax, ebx
        pop     rbx
        ret
.L5:
        xor     edi, edi
        call    time
        xchg    eax, DWORD PTR get_xid2()::xid[rip]
        jmp     .L1
get_xid2()::xid:
        .long   -1
```


| flow | ins | op | result |
| ---- | ---- | ---- | ---- |
| t1 | load | xid | -1 |
| t2 | load | xid | -1 |
| t1 | store | xid | time(0), assume it's x |
| t2 | store | xid | time(0), assume it's x |
| t1 | cas | xid | x |
| t2 | cas | xid | x |
