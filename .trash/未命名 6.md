I1216 10:26:34.284596 238258 test_main.cc:83] [ RUN      ] IOCacheTest.LatencySequential
I1216 10:26:34.287446 238267 thread.cc:114] Set thread name to: io-cache1
I1216 10:26:34.287488 238267 coroutine.cc:372] Adjust max cached coroutines for current thread,  old: 64 new:64 current:0
=================================================================
==238258==ERROR: AddressSanitizer: attempting double-free on 0x6250000f2900 in thread T0:
I1216 10:26:34.309502 238267 io_cache_test.cc:525] out UIOCtx: [0, 262144]
I1216 10:26:34.309741 238267 io_cache_test.cc:525] out UIOCtx: [262144, 262144]
I1216 10:26:34.309895 238267 io_cache_test.cc:525] out UIOCtx: [524288, 262144]
I1216 10:26:34.310107 238267 io_cache_test.cc:525] out UIOCtx: [786432, 262144]
I1216 10:26:34.310267 238267 io_cache_test.cc:525] out UIOCtx: [1048576, 262144]
I1216 10:26:34.310415 238267 io_cache_test.cc:525] out UIOCtx: [1310720, 262144]
I1216 10:26:34.310537 238267 io_cache_test.cc:525] out UIOCtx: [1572864, 262144]
I1216 10:26:34.310858 238267 io_cache_test.cc:525] out UIOCtx: [1835008, 262144]
I1216 10:26:34.331303 238267 io_cache_test.cc:525] out UIOCtx: [2097152, 28672]
    #0 0x7fdea02b80f0 in operator delete(void*) (/usr/lib64/libasan.so.4+0xe20f0)
    #1 0x55b60d96a7e3 in __gnu_cxx::new_allocator<zbs::Arena*>::deallocate(zbs::Arena**, unsigned long) /usr/include/c++/7.3.0/ext/new_allocator.h:125
    #2 0x55b60d96a7e3 in std::allocator_traits<std::allocator<zbs::Arena*> >::deallocate(std::allocator<zbs::Arena*>&, zbs::Arena**, unsigned long) /usr/include/c++/7.3.0/bits/alloc_traits.h:462
    #3 0x55b60d96a7e3 in std::_Vector_base<zbs::Arena*, std::allocator<zbs::Arena*> >::_M_deallocate(zbs::Arena**, unsigned long) /usr/include/c++/7.3.0/bits/stl_vector.h:180
    #4 0x55b60d96a7e3 in std::vector<zbs::Arena*, std::allocator<zbs::Arena*> >::reserve(unsigned long) /usr/include/c++/7.3.0/bits/vector.tcc:78
    #5 0x55b60d96b31b in zbs::ArenaPool::GetArena() ../src/common/arena.cc:218
    #6 0x55b6103b4b61 in zbs::test::IOCacheTest::NewUIOCtx(unsigned __int128, unsigned long, unsigned int, bool) ../src/tests/io_cache_test.cc:96
    #7 0x55b6103c109a in zbs::test::IOCacheTest_LatencySequential_Test::TestBody() ../src/tests/io_cache_test.cc:537
    #8 0x55b610aa0cf2 in void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ../gtest/googletest/src/gtest.cc:2402
    #9 0x55b610aa0cf2 in void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ../gtest/googletest/src/gtest.cc:2438
    #10 0x55b610aa0ea3 in testing::Test::Run() ../gtest/googletest/src/gtest.cc:2474
    #11 0x55b610aa1148 in testing::TestInfo::Run() ../gtest/googletest/src/gtest.cc:2656
    #12 0x55b610aa1388 in testing::TestCase::Run() ../gtest/googletest/src/gtest.cc:2774
    #13 0x55b610aa1595 in testing::internal::UnitTestImpl::RunAllTests() ../gtest/googletest/src/gtest.cc:4649
    #14 0x55b610aa1918 in bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ../gtest/googletest/src/gtest.cc:2402
    #15 0x55b610aa1918 in bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ../gtest/googletest/src/gtest.cc:2438
    #16 0x55b610aa1a7d in testing::UnitTest::Run() ../gtest/googletest/src/gtest.cc:4257
    #17 0x55b60fe013d5 in RUN_ALL_TESTS() ../gtest/googletest/include/gtest/gtest.h:2233
    #18 0x55b60fe013d5 in main ../src/tests/test_main.cc:145
    #19 0x7fde9f1ccb26 in __libc_start_main (/usr/lib64/libc.so.6+0x25b26)
    #20 0x55b60bb52a49 in _start (/tmp/tmp.wXWRzwRytS/cmake-build-debug/src/zbs_test+0x1095a49)

0x6250000f2900 is located 0 bytes inside of 8288-byte region [0x6250000f2900,0x6250000f4960)
freed by thread T9 (io-cache1) here:
    #0 0x7fdea02b80f0 in operator delete(void*) (/usr/lib64/libasan.so.4+0xe20f0)
    #1 0x55b60d96a7e3 in __gnu_cxx::new_allocator<zbs::Arena*>::deallocate(zbs::Arena**, unsigned long) /usr/include/c++/7.3.0/ext/new_allocator.h:125
    #2 0x55b60d96a7e3 in std::allocator_traits<std::allocator<zbs::Arena*> >::deallocate(std::allocator<zbs::Arena*>&, zbs::Arena**, unsigned long) /usr/include/c++/7.3.0/bits/alloc_traits.h:462
    #3 0x55b60d96a7e3 in std::_Vector_base<zbs::Arena*, std::allocator<zbs::Arena*> >::_M_deallocate(zbs::Arena**, unsigned long) /usr/include/c++/7.3.0/bits/stl_vector.h:180
    #4 0x55b60d96a7e3 in std::vector<zbs::Arena*, std::allocator<zbs::Arena*> >::reserve(unsigned long) /usr/include/c++/7.3.0/bits/vector.tcc:78
    #5 0x55b60d96b31b in zbs::ArenaPool::GetArena() ../src/common/arena.cc:218
    #6 0x55b60ce69b58 in zbs::libzbs::UIOCtxGroup::Into(zbs::ArenaPool&) ../src/libzbs/io_cache.cc:38
    #7 0x55b60ce7e59f in zbs::libzbs::IOCacheQueue::ReapAll(zbs::ArenaPool&) ../src/libzbs/io_cache.cc:205
    #8 0x55b60ce7fc82 in zbs::libzbs::IOCache::ReapAll(zbs::ArenaPool&) ../src/libzbs/io_cache.cc:298
    #9 0x55b6103b0564 in operator() ../src/tests/io_cache_test.cc:523
    #10 0x55b6103b0564 in _M_invoke /usr/include/c++/7.3.0/bits/std_function.h:316
    #11 0x55b60db79c4a in std::function<void ()>::operator()() const /usr/include/c++/7.3.0/bits/std_function.h:706
    #12 0x55b60db79c4a in zbs::TimerHandle::Impl::Routine(std::function<void ()> const&) ../src/common/timer_handle.cc:103
    #13 0x55b60db79d9b in operator() ../src/common/timer_handle.cc:42
    #14 0x55b60db79d9b in s_run_and_reset ../src/common/coroutine.h:268
    #15 0x55b60d9c2f75 in zbs::CoFunc::run_and_reset() ../src/common/coroutine.h:304
    #16 0x55b60d9c2f75 in zbs::Coroutine::LoopMain() ../src/common/coroutine.cc:558
    #17 0x55b60d9c3079 in zbs::Coroutine::s_co_main(int, int) ../src/common/coroutine.cc:545
    #18 0x7fde9f1f496f  (/usr/lib64/libc.so.6+0x4d96f)

previously allocated by thread T0 here:
    #0 0x7fdea02b7278 in operator new(unsigned long) (/usr/lib64/libasan.so.4+0xe1278)
    #1 0x55b60d96a796 in __gnu_cxx::new_allocator<zbs::Arena*>::allocate(unsigned long, void const*) /usr/include/c++/7.3.0/ext/new_allocator.h:111
    #2 0x55b60d96a796 in std::allocator_traits<std::allocator<zbs::Arena*> >::allocate(std::allocator<zbs::Arena*>&, unsigned long) /usr/include/c++/7.3.0/bits/alloc_traits.h:436
    #3 0x55b60d96a796 in std::_Vector_base<zbs::Arena*, std::allocator<zbs::Arena*> >::_M_allocate(unsigned long) /usr/include/c++/7.3.0/bits/stl_vector.h:172
    #4 0x55b60d96a796 in zbs::Arena** std::vector<zbs::Arena*, std::allocator<zbs::Arena*> >::_M_allocate_and_copy<std::move_iterator<zbs::Arena**> >(unsigned long, std::move_iterator<zbs::Arena**>, std::move_iterator<zbs::Arena**>) /usr/include/c++/7.3.0/bits/stl_vector.h:1260
    #5 0x55b60d96a796 in std::vector<zbs::Arena*, std::allocator<zbs::Arena*> >::reserve(unsigned long) /usr/include/c++/7.3.0/bits/vector.tcc:73
    #6 0x55b60d96b31b in zbs::ArenaPool::GetArena() ../src/common/arena.cc:218
    #7 0x55b6103b4b61 in zbs::test::IOCacheTest::NewUIOCtx(unsigned __int128, unsigned long, unsigned int, bool) ../src/tests/io_cache_test.cc:96
    #8 0x55b6103c109a in zbs::test::IOCacheTest_LatencySequential_Test::TestBody() ../src/tests/io_cache_test.cc:537
    #9 0x55b610aa0cf2 in void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ../gtest/googletest/src/gtest.cc:2402
    #10 0x55b610aa0cf2 in void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ../gtest/googletest/src/gtest.cc:2438
    #11 0x55b610aa0ea3 in testing::Test::Run() ../gtest/googletest/src/gtest.cc:2474
    #12 0x55b610aa1148 in testing::TestInfo::Run() ../gtest/googletest/src/gtest.cc:2656
    #13 0x55b610aa1388 in testing::TestCase::Run() ../gtest/googletest/src/gtest.cc:2774
    #14 0x55b610aa1595 in testing::internal::UnitTestImpl::RunAllTests() ../gtest/googletest/src/gtest.cc:4649
    #15 0x55b610aa1918 in bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ../gtest/googletest/src/gtest.cc:2402
    #16 0x55b610aa1918 in bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ../gtest/googletest/src/gtest.cc:2438
    #17 0x55b610aa1a7d in testing::UnitTest::Run() ../gtest/googletest/src/gtest.cc:4257
    #18 0x55b60fe013d5 in RUN_ALL_TESTS() ../gtest/googletest/include/gtest/gtest.h:2233
    #19 0x55b60fe013d5 in main ../src/tests/test_main.cc:145
    #20 0x7fde9f1ccb26 in __libc_start_main (/usr/lib64/libc.so.6+0x25b26)

Thread T9 (io-cache1) created by T0 here:
    #0 0x7fdea020eb5f in pthread_create (/usr/lib64/libasan.so.4+0x38b5f)
    #1 0x55b60db4d2c7 in zbs::Thread::Start(int) ../src/common/thread.cc:264
    #2 0x55b60db5ce9f in zbs::ThreadContext::Start() ../src/common/thread_context.cc:221
    #3 0x55b6103c0e73 in zbs::test::IOCacheTest_LatencySequential_Test::TestBody() ../src/tests/io_cache_test.cc:531
    #4 0x55b610aa0cf2 in void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ../gtest/googletest/src/gtest.cc:2402
    #5 0x55b610aa0cf2 in void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) ../gtest/googletest/src/gtest.cc:2438
    #6 0x55b610aa0ea3 in testing::Test::Run() ../gtest/googletest/src/gtest.cc:2474
    #7 0x55b610aa1148 in testing::TestInfo::Run() ../gtest/googletest/src/gtest.cc:2656
    #8 0x55b610aa1388 in testing::TestCase::Run() ../gtest/googletest/src/gtest.cc:2774
    #9 0x55b610aa1595 in testing::internal::UnitTestImpl::RunAllTests() ../gtest/googletest/src/gtest.cc:4649
    #10 0x55b610aa1918 in bool testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ../gtest/googletest/src/gtest.cc:2402
    #11 0x55b610aa1918 in bool testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) ../gtest/googletest/src/gtest.cc:2438
    #12 0x55b610aa1a7d in testing::UnitTest::Run() ../gtest/googletest/src/gtest.cc:4257
    #13 0x55b60fe013d5 in RUN_ALL_TESTS() ../gtest/googletest/include/gtest/gtest.h:2233
    #14 0x55b60fe013d5 in main ../src/tests/test_main.cc:145
    #15 0x7fde9f1ccb26 in __libc_start_main (/usr/lib64/libc.so.6+0x25b26)

SUMMARY: AddressSanitizer: double-free (/usr/lib64/libasan.so.4+0xe20f0) in operator delete(void*)
==238258==ABORTING
) #                  1 â†µ
