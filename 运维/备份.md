#backup #btrbk #btrfs

# Mount

```bash
# sudo mkdir -p /mnt/backup
# sudo cat /etc/systemd/system/mnt-backup.mount
[Unit]
Description=Mount SMB Share
After=network-online.target
Wants=network-online.target

[Mount]
What=//10.1.2.164/Backup
Where=/mnt/backup
Type=cifs
Options=credentials=/etc/smbcredentials,iocharset=utf8,file_mode=0644,dir_mode=0755,uid=1000,gid=1000 # 501,20
TimeoutSec=10

[Install]
WantedBy=multi-user.target
```

```bash
-> % sudo cat /etc/smbcredentials
username=xxx
password=xxx

-> % sudo stat /etc/smbcredentials
  File: /etc/smbcredentials
  Size: 39              Blocks: 8          IO Block: 4096   regular file
Device: 0,26    Inode: 1819388     Links: 1
Access: (0600/-rw-------)  Uid: (    0/    root)   Gid: (    0/    root)
```

# btrbk

```bash
pacman -S btrbk mbuffer
```

```bash
# cat /etc/btrbk/btrbk.conf
raw_target_compress    zstd
snapshot_create        ondemand
snapshot_preserve_min  2d
snapshot_preserve      14d
target_preserve_min    no
target_preserve        20d 10w *m

volume /
  subvolume /
    target raw /mnt/backup/btrbk/srv
```

```bash
# dry
sudo btrbk --progress -v -n run
# real
sudo btrbk --progress run
```

```
systemctl enable --now btrbk.timer
```
