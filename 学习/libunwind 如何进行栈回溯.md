#Linux
`libunwind` 是一个用于获取函数调用栈（栈回溯）的库，主要用于 C 和 C++ 程序。在 x64 Linux 下，`libunwind` 通过分析栈帧和寄存器来获取函数调用栈。它主要执行以下步骤：

1. **获取当前栈帧的信息**：`libunwind` 首先获取当前栈帧的信息，包括栈指针（RSP）和基指针（RBP）。这些寄存器值可以通过内联汇编或特定的函数获取，例如 `getcontext()`。
2. **分析栈帧**：`libunwind` 分析当前栈帧以找到上一个栈帧的位置。在 x64 Linux 下，默认情况下，函数调用遵循 System V AMD64 ABI。根据调用约定，返回地址保存在当前栈帧的基指针（RBP）上方（即 RBP + 8）。因此，`libunwind` 可以从当前栈帧获取返回地址。
3. **获取上一个栈帧的信息**：`libunwind` 使用当前栈帧的返回地址找到上一个栈帧。然后，它从上一个栈帧的基指针（RBP）处获取保存的基指针（通常在 RBP - 8 的位置）。这些信息使 `libunwind` 能够找到整个函数调用栈。
4. **重复过程**：`libunwind` 重复这个过程，直到它遍历了整个函数调用栈。在每个步骤中，它可以获取函数的返回地址（即调用栈中的一个条目）。根据这些地址，可以查询符号表以获取函数名和其他调试信息。

请注意，这里描述的过程是基于默认的 System V AMD64 ABI。如果编译器使用了不同的调用约定（例如，不使用帧指针优化），那么 `libunwind` 可能需要采用其他方法来分析栈帧。在这种情况下，`libunwind` 可能会使用 DWARF 调试信息和 CFI（Call Frame Information）来解析栈帧。

总之，`libunwind` 在 x64 Linux 下通过分析栈帧和寄存器值来执行栈回溯。这个过程可能因编译器设置、优化级别和调用约定而有所不同。
