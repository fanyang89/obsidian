```
root@yl-readtest:~# cat /sys/block/vdb/queue/write_cache
write back
root@yl-readtest:~# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sr0     11:0    1 1024M  0 rom
zram0  251:0    0  7.7G  0 disk [SWAP]
vda    252:0    0   40G  0 disk
├─vda1 252:1    0    1M  0 part
├─vda2 252:2    0    1G  0 part /boot
└─vda3 252:3    0   39G  0 part /
vdb    252:16   0  200G  0 disk
└─vdb1 252:17   0  200G  0 part
vdc    252:32   0  200G  0 disk
vdd    252:48   0   40G  0 disk
vde    252:64   0   40G  0 disk
vdf    252:80   0  100G  0 disk
vdg    252:96   0   30G  0 disk
root@yl-readtest:~# mount /dev/vdb1 /mnt/data/
root@yl-readtest:~# cat /sys/block/vdb/queue/write_cache
write back
root@yl-readtest:~# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sr0     11:0    1 1024M  0 rom
zram0  251:0    0  7.7G  0 disk [SWAP]
vda    252:0    0   40G  0 disk
├─vda1 252:1    0    1M  0 part
├─vda2 252:2    0    1G  0 part /boot
└─vda3 252:3    0   39G  0 part /
vdb    252:16   0  200G  0 disk
└─vdb1 252:17   0  200G  0 part /mnt/data
vdc    252:32   0  200G  0 disk
vdd    252:48   0   40G  0 disk
vde    252:64   0   40G  0 disk
vdf    252:80   0  100G  0 disk
vdg    252:96   0   30G  0 disk
root@yl-readtest:~# pg_test_fsync -f /mnt/data/test-file1
5 seconds per test
O_DIRECT supported on this platform for open_datasync and open_sync.

Compare file sync methods using one 8kB write:
(in wal_sync_method preference order, except fdatasync is Linux's default)
        open_datasync                      5556.396 ops/sec     180 usecs/op
        fdatasync                          5182.916 ops/sec     193 usecs/op
        fsync                              3895.787 ops/sec     257 usecs/op
        fsync_writethrough                              n/a
        open_sync                          3836.997 ops/sec     261 usecs/op

Compare file sync methods using two 8kB writes:
(in wal_sync_method preference order, except fdatasync is Linux's default)
        open_datasync                       135.979 ops/sec    7354 usecs/op
        fdatasync                          4622.252 ops/sec     216 usecs/op
        fsync                              3213.054 ops/sec     311 usecs/op
        fsync_writethrough                              n/a
        open_sync                           103.513 ops/sec    9661 usecs/op

Compare open_sync with different write sizes:
(This is designed to compare the cost of writing 16kB in different write
open_sync sizes.)
         1 * 16kB open_sync write          3464.663 ops/sec     289 usecs/op
         2 *  8kB open_sync writes           97.983 ops/sec   10206 usecs/op
         4 *  4kB open_sync writes          995.135 ops/sec    1005 usecs/op
         8 *  2kB open_sync writes          535.393 ops/sec    1868 usecs/op
        16 *  1kB open_sync writes          184.338 ops/sec    5425 usecs/op

Test if fsync on non-write file descriptor is honored:
(If the times are similar, fsync() can sync data written on a different
descriptor.)
        write, fsync, close                3471.283 ops/sec     288 usecs/op
        write, close, fsync                3532.280 ops/sec     283 usecs/op

Non-sync'ed 8kB writes:
        write                            501813.795 ops/sec       2 usecs/op
```

```
➜  ~ sudo perf stat -r 100 --null sg_sync /dev/sdc

 Performance counter stats for 'sg_sync /dev/sdc' (100 runs):

           0.00513 +- 0.00118 seconds time elapsed  ( +- 23.05% )

➜  ~ sudo perf stat -r 10000 --null sg_sync /dev/sdc
 Performance counter stats for 'sg_sync /dev/sdc' (10000 runs):
         0.0040397 +- 0.0000876 seconds time elapsed  ( +-  2.17% )

➜  ~ hostname
fygod
➜  ~ date
Tue Aug 19 11:54:39 AM CST 2025
```

## ext4

```
root@yl-readtest:~# mkfs.ext4 /dev/sda1
mke2fs 1.47.1 (20-May-2024)
/dev/sda1 contains a xfs file system
Proceed anyway? (y,N) y
Discarding device blocks: done
Creating filesystem with 10485248 4k blocks and 2621440 inodes
Filesystem UUID: 06197c84-7d21-4a4e-bba0-7ed3b62ca303
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
	4096000, 7962624

Allocating group tables: done
Writing inode tables: done
Creating journal (65536 blocks): done
Writing superblocks and filesystem accounting information: done

root@yl-readtest:~# mount -o noatime /dev/sda1 /mnt/data1
root@yl-readtest:~# findmnt /mnt/data1
TARGET     SOURCE    FSTYPE OPTIONS
/mnt/data1 /dev/sda1 ext4   rw,noatime,seclabel
root@yl-readtest:~# cd /mnt/data1/
root@yl-readtest:/mnt/data1# ls
lost+found
root@yl-readtest:/mnt/data1# sysbench fileio --threads=20 --file-total-size=2G --file-test-mode=rndrw prepare
sysbench 1.0.20 (using system LuaJIT 2.1.1713773202)

128 files, 16384Kb each, 2048Mb total
Creating files for the test...
Extra file open flags: (none)
Creating file test_file.0
Creating file test_file.1
Creating file test_file.2
Creating file test_file.3
// ...
Creating file test_file.125
Creating file test_file.126
Creating file test_file.127
2147483648 bytes written in 2.43 seconds (842.62 MiB/sec).
root@yl-readtest:/mnt/data1# sysbench fileio --threads=20 --file-total-size=2G --file-test-mode=rndrw run
sysbench 1.0.20 (using system LuaJIT 2.1.1713773202)

Running the test with following options:
Number of threads: 20
Initializing random number generator from current time


Extra file open flags: (none)
128 files, 16MiB each
2GiB total file size
Block size 16KiB
Number of IO requests: 0
Read/Write ratio for combined random IO test: 1.50
Periodic FSYNC enabled, calling fsync() each 100 requests.
Calling fsync() at the end of test, Enabled.
Using synchronous I/O mode
Doing random r/w test
Initializing worker threads...

Threads started!


File operations:
    reads/s:                      38029.23
    writes/s:                     25352.82
    fsyncs/s:                     81377.57

Throughput:
    read, MiB/s:                  594.21
    written, MiB/s:               396.14

General statistics:
    total time:                          10.0090s
    total number of events:              1446588

Latency (ms):
         min:                                    0.00
         avg:                                    0.13
         max:                                   21.48
         95th percentile:                        0.77
         sum:                               192143.28

Threads fairness:
    events (avg/stddev):           72329.4000/624.92
    execution time (avg/stddev):   9.6072/0.00
```

```
root@yl-readtest:/mnt/data1# stat test_file.127
  File: test_file.127
  Size: 16777216  	Blocks: 32768      IO Block: 4096   regular file
Device: 8,1	Inode: 33282       Links: 1
Access: (0600/-rw-------)  Uid: (    0/    root)   Gid: (    0/    root)
Context: unconfined_u:object_r:unlabeled_t:s0
Access: 2025-08-19 15:46:35.397938623 +0800
Modify: 2025-08-19 15:46:35.403939132 +0800
Change: 2025-08-19 15:46:35.403939132 +0800
 Birth: 2025-08-19 15:46:35.397938623 +0800

root@yl-readtest:/mnt/data1# sysbench fileio --threads=20 --file-total-size=2G --file-test-mode=rndrd run

root@yl-readtest:/mnt/data1# stat test_file.127
  File: test_file.127
  Size: 16777216  	Blocks: 32768      IO Block: 4096   regular file
Device: 8,1	Inode: 33282       Links: 1
Access: (0600/-rw-------)  Uid: (    0/    root)   Gid: (    0/    root)
Context: unconfined_u:object_r:unlabeled_t:s0
Access: 2025-08-19 15:47:14.584257012 +0800
Modify: 2025-08-19 15:46:35.403939132 +0800
Change: 2025-08-19 15:46:35.403939132 +0800
 Birth: 2025-08-19 15:46:35.397938623 +0800

root@yl-readtest:/mnt/data1# sysbench fileio --threads=20 --file-total-size=2G --file-test-mode=rndrw run
sysbench 1.0.20 (using system LuaJIT 2.1.1713773202)

Running the test with following options:
Number of threads: 20
Initializing random number generator from current time


Extra file open flags: (none)
128 files, 16MiB each
2GiB total file size
Block size 16KiB
Number of IO requests: 0
Read/Write ratio for combined random IO test: 1.50
Periodic FSYNC enabled, calling fsync() each 100 requests.
Calling fsync() at the end of test, Enabled.
Using synchronous I/O mode
Doing random r/w test
Initializing worker threads...

Threads started!


File operations:
    reads/s:                      19921.37
    writes/s:                     13281.08
    fsyncs/s:                     42747.43

Throughput:
    read, MiB/s:                  311.27
    written, MiB/s:               207.52

General statistics:
    total time:                          10.0067s
    total number of events:              757569

Latency (ms):
         min:                                    0.00
         avg:                                    0.26
         max:                                   19.99
         95th percentile:                        1.30
         sum:                               197797.21

Threads fairness:
    events (avg/stddev):           37878.4500/572.37
    execution time (avg/stddev):   9.8899/0.00


root@yl-readtest:/mnt/data1# stat test_file.127
  File: test_file.127
  Size: 16777216  	Blocks: 32768      IO Block: 4096   regular file
Device: 8,1	Inode: 33282       Links: 1
Access: (0600/-rw-------)  Uid: (    0/    root)   Gid: (    0/    root)
Context: unconfined_u:object_r:unlabeled_t:s0
Access: 2025-08-19 15:48:03.501395796 +0800
Modify: 2025-08-19 15:48:03.501395796 +0800
Change: 2025-08-19 15:48:03.501395796 +0800
 Birth: 2025-08-19 15:46:35.397938623 +0800
```
