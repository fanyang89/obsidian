
## MetaDB Corrupted

```
I0810 22:41:22.440515 25742 db_cluster.cc:280] Try to open/create db zdb_config
E0810 22:41:22.440594 25742 meta_server.cc:402] Fail initializing meta context: 
Traceback:
[EDBCorrupt]: Corruption: CURRENT file does not end with newline : failed to open/create db /var/lib/zbs/metad/db//meta/zdb_config
I0810 22:41:22.440604 25742 quorum_server.cc:51] Quorum server begins stopping, this: 0x5598c2e74000
I0810 22:41:22.440609 25742 quorum_cluster.cc:393] QuorumCluster state change: Running --> Stopped
I0810 22:41:22.440615 25742 quorum_server.cc:56] Quorum server stopped, this: 0x5598c2e74000
I0810 22:41:22.440619 25742 meta_server.cc:406] [MetaServer] initializing meta context done, this: 0x5598c2e74000, status: 
Traceback:
[EDBCorrupt]: Corruption: CURRENT file does not end with newline : failed to open/create db /var/lib/zbs/metad/db//meta/zdb_config
```

```
-> % fd CURRENT | grep zdb | grep -v old
metadb/node01/var/lib/zbs/metad/db/meta/zdb_config/CURRENT
metadb/node02/var/lib/zbs/metad/db/meta/zdb_config/CURRENT
metadb/node03/var/lib/zbs/metad/db/meta/zdb_config/CURRENT
```

```
fanmi@ds [12:58:09] [~/tmp/cs1121436] 
-> % xxd metadb/node01/var/lib/zbs/metad/db/meta/zdb_config/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3231 390a  MANIFEST-000219.

fanmi@ds [12:59:32] [~/tmp/cs1121436] 
-> % xxd metadb/node02/var/lib/zbs/metad/db/meta/zdb_config/CURRENT
00000000: 6361 3633 6535 3212 3437 3435 6137 6233  ca63e52.4745a7b3
```

```
fanmi@ds [13:00:12] [~/tmp/cs1121436] 
-> % ls metadb/node02/var/lib/zbs/metad/db/meta/zdb_config        
000128.ldb  CURRENT  LOCK  LOG  LOG.old

fanmi@ds [13:00:18] [~/tmp/cs1121436] 
-> % ls metadb/node01/var/lib/zbs/metad/db/meta/zdb_config
000237.ldb  000239.ldb  000240.log  000241.ldb  CURRENT  LOCK  LOG  LOG.old  MANIFEST-000219

fanmi@ds [13:00:21] [~/tmp/cs1121436] 
-> % ls metadb/node03/var/lib/zbs/metad/db/meta/zdb_config
000229.ldb  000231.ldb  000232.log  CURRENT  LOCK  LOG  LOG.old  MANIFEST-000230
```

```
-> % fd -tf CURRENT metadb/node02/var/lib/zbs/metad/db/meta -x bash -c "echo {}; xxd {}; echo '';"
metadb/node02/var/lib/zbs/metad/db/meta/mc/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3039 300a  MANIFEST-000090.

metadb/node02/var/lib/zbs/metad/db/meta/sa/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3034 350a  MANIFEST-000045.

metadb/node02/var/lib/zbs/metad/db/meta/cdp/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3034 350a  MANIFEST-000045.

metadb/node02/var/lib/zbs/metad/db/meta/ta/CURRENT
00000000: 6361 3633 6535 3212 3437 3435 6137 6233  ca63e52.4745a7b3

metadb/node02/var/lib/zbs/metad/db/meta/c2/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3035 3437 370a  MANIFEST-005477.

metadb/node02/var/lib/zbs/metad/db/meta/nva/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3034 350a  MANIFEST-000045.

metadb/node02/var/lib/zbs/metad/db/meta/zdb_config/CURRENT
00000000: 6361 3633 6535 3212 3437 3435 6137 6233  ca63e52.4745a7b3

metadb/node02/var/lib/zbs/metad/db/meta/ssi/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3038 380a  MANIFEST-000088.

metadb/node02/var/lib/zbs/metad/db/meta/e/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3331 310a  MANIFEST-000311.

metadb/node02/var/lib/zbs/metad/db/meta/ss/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3039 300a  MANIFEST-000090.

metadb/node02/var/lib/zbs/metad/db/meta/a/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3337 3737 390a  MANIFEST-037779.

metadb/node02/var/lib/zbs/metad/db/meta/vio/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3034 350a  MANIFEST-000045.

metadb/node02/var/lib/zbs/metad/db/meta/ng/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3034 350a  MANIFEST-000045.

metadb/node02/var/lib/zbs/metad/db/meta/pe/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3238 330a  MANIFEST-000283.

metadb/node02/var/lib/zbs/metad/db/meta/vsi/CURRENT
00000000: 4d41 4e49 4645 5354 2d30 3030 3038 380a  MANIFEST-000088.
```

```
-> % fd -tf CURRENT metadb/node02/var/lib/zbs/metad/db/meta -x bash -c "echo {//}; ls {//} | wc -l"
metadb/node02/var/lib/zbs/metad/db/meta/ng
6
metadb/node02/var/lib/zbs/metad/db/meta/a
7
metadb/node02/var/lib/zbs/metad/db/meta/ta
6
metadb/node02/var/lib/zbs/metad/db/meta/ssi
6
metadb/node02/var/lib/zbs/metad/db/meta/nva
6
metadb/node02/var/lib/zbs/metad/db/meta/vio
6
metadb/node02/var/lib/zbs/metad/db/meta/c2
12
metadb/node02/var/lib/zbs/metad/db/meta/mc
8
metadb/node02/var/lib/zbs/metad/db/meta/ss
9
metadb/node02/var/lib/zbs/metad/db/meta/pe
11
metadb/node02/var/lib/zbs/metad/db/meta/sa
6
metadb/node02/var/lib/zbs/metad/db/meta/cdp
6
metadb/node02/var/lib/zbs/metad/db/meta/e
7
metadb/node02/var/lib/zbs/metad/db/meta/zdb_config
5
metadb/node02/var/lib/zbs/metad/db/meta/vsi
6
```